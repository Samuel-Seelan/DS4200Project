<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visualizations - SFO Air Traffic</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

  <header>
    <h1>Data Visualizations</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
      </ul>
    </nav>
  </header>

  <section class="content">
    <h2>Interactive D3.js Chart</h2>
    <div id="d3-chart"></div>
    <script>
const margin = { top: 50, right: 30, bottom: 80, left: 140 },
      width = 1100 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

const svg = d3.select("#d3-chart")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

const tooltip = d3.select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("opacity", 0)
  .style("position", "absolute")
  .style("background", "#fff")
  .style("padding", "8px")
  .style("border", "1px solid #ccc")
  .style("border-radius", "4px")
  .style("font-size", "12px")
  .style("box-shadow", "2px 2px 6px rgba(0,0,0,0.1)");

d3.csv("d3_data.csv").then(data => {
  data.forEach(d => {
    d["Normalised Count"] = +d["Normalised Count"];
    d["Passenger Count"] = +d["Passenger Count"];
  });

  const allRegions = Array.from(new Set(data.map(d => d["GEO Region"]))).sort();
  const dropdown = d3.select("#d3-chart")
    .insert("div", ":first-child")
    .attr("class", "dropdown")
    .html(`
      <label for="region-select">Filter by Region: </label>
      <select id="region-select">
        <option value="All">All Regions</option>
        ${allRegions.map(region => `<option value="${region}">${region}</option>`).join("")}
      </select>
    `);

  function update(region) {
    const filtered = region === "All" ? data : data.filter(d => d["GEO Region"] === region);
    const airlines = Array.from(new Set(filtered.map(d => d["Operating Airline"]))).sort();
    const months = Array.from(new Set(filtered.map(d => d["Year-Month"]))).sort();

    const x = d3.scaleBand().domain(months).range([0, width]).padding(0.05);
    const y = d3.scaleBand().domain(airlines).range([0, height]).padding(0.05);
    const color = d3.scaleSequential(d3.interpolateOrRd).domain([0, 1]);

    svg.selectAll("*").remove();

    const xAxis = d3.axisTop(x)
      .tickValues(x.domain().filter((d, i) => i % Math.ceil(x.domain().length / 20) === 0));
    
    svg.append("g")
      .attr("transform", `translate(0, 0)`)
      .call(d3.axisTop(x))
      .selectAll("text")
        .attr("transform", "rotate(-60)")
        .style("text-anchor", "end");

    svg.append("g")
      .call(d3.axisLeft(y));

    svg.selectAll()
      .data(filtered)
      .enter()
      .append("rect")
        .attr("x", d => x(d["Year-Month"]))
        .attr("y", d => y(d["Operating Airline"]))
        .attr("width", x.bandwidth())
        .attr("height", y.bandwidth())
        .style("fill", d => color(d["Normalised Count"]))
        .on("mouseover", function(event, d) {
          tooltip.transition().duration(200).style("opacity", 0.95);
          tooltip
            .html(`
              <strong>Airline:</strong> ${d["Operating Airline"]}<br>
              <strong>Month:</strong> ${d["Year-Month"]}<br>
              <strong>Region:</strong> ${d["GEO Region"]}<br>
              <strong>Passengers:</strong> ${d["Passenger Count"].toLocaleString()}<br>
              <strong>Normalised:</strong> ${(d["Normalised Count"] * 100).toFixed(1)}%
            `)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 40) + "px");
        })
        .on("mouseout", function() {
          tooltip.transition().duration(300).style("opacity", 0);
        });
  }

  update("All");

  d3.select("#region-select").on("change", function() {
    update(this.value);
  });
});
</script>
  </section>

  <section class="content">
    <h2>Other Visualizations</h2>
    <p>Other interactive charts are included in our <strong>Jupyter Notebook</strong>. Please download and view <code>sfo_visualizations.ipynb</code> for full interactivity or view static images below:</p>

    <!-- Passenger Trend -->
    <img src="assets/plots/passenger_trend.png" alt="Passenger Volume Over Time" />
    <p class="viz-description">
      From 1999 to 2023, SFO’s airline passenger volume generally trends upward, showing long-term growth in air travel throughout the years. Each year reveals a seasonal pattern where passenger counts peak in the summer months and dip to the lowest points in the winter for that year. This might be caused by vacation and holiday travel cycles.
    </p>
    <p class="viz-description">
      A sharp and well-documented drop occurs in 2001, directly following the September 11 attacks, which significantly impacted air travel nationwide. While 2008–2010 shows a slight decline in the yearly growth rate of air travel during the global financial crisis, the change is relatively modest and less pronounced.
    </p>
    <p class="viz-description">
      The biggest disruption we noticed appears to start from late 2019 and 2020, when airline passenger volume plummeted due to the start of the COVID-19 pandemic. This sudden decline prompted us to do a more in-depth focused analysis of the pandemic years.
    </p>
    <p class="viz-description">
      By comparing COVID-19 hospitalization and testing trends with SFO passenger counts, we found clear inverse relationships—travel fell during periods where positive cases and hospitalizations spiked. However, as the vaccine became widely available in late 2020 and early 2021, passenger counts began to recover quickly. As of 2023, SFO’s passenger traffic has not yet fully returned to its pre-pandemic peak, highlighting the ongoing effects of the pandemic on the air travel industry.
    </p>

    <!-- Airline Market Share / Sankey -->
    <img src="assets/plots/airline_market_share.png" alt="Airline Market Share / Sankey" />
    <p class="viz-description">
      This visualization is a Sankey diagram that illustrates the flow of air traffic from specific airlines, segmented by terminals at San Francisco International Airport (SFO), to global regions. Each terminal has a unique traffic profile: Terminal 3 is dominated by United Airlines and focuses mostly on domestic U.S. routes, while Terminal 1 hosts a broader mix of domestic carriers serving Canada, Mexico, and the U.S.
    </p>
    <p class="viz-description">
      Terminal 2 shows a hybrid pattern, with both domestic airlines and international carriers like Air Canada and Lufthansa connecting to Europe and Asia. The International Terminal displays the most complex network, with dozens of airlines connecting SFO to nearly every global region—especially Asia and Europe. In contrast, the "Other" category shows smaller operators (like Ameriflight and Sports Hawk) that primarily serve domestic routes.
    </p>
    <p class="viz-description">
      This Sankey diagram breaks down how the operations of SFO are structured and how terminals are specialized in flying certain routes while highlighting where the largest concentration of flights are headed to.
    </p>

    <!-- COVID Impact -->
    <img src="assets/plots/covid_impact.png" alt="COVID Impact on SFO Traffic" />

    <!-- Geo Map -->
    <img src="assets/plots/geo_map.png" alt="Geographical Distribution" />
  </section>

  <footer>
    <p>© 2025 Samuel Seelan — DS 4200 Project</p>
  </footer>

</body>
</html>
