<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visualizations - SFO Air Traffic</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    .tooltip {
      position: absolute;
      background: #fff;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .dropdown {
      margin: 10px auto;
      text-align: center;
    }
    .legend {
      text-align: center;
      margin-top: 10px;
    }
    .legend span {
      margin-right: 12px;
      font-size: 13px;
    }
    svg {
      display: block;
      margin: 0 auto;
    }
    .viz-description {
      max-width: 850px;
      margin: 10px auto;
      text-align: justify;
      font-size: 15px;
      line-height: 1.6;
    }
  </style>
</head>
<body>

  <header>
    <h1>Data Visualizations</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
      </ul>
    </nav>
  </header>

  <main class="intro">
    <div class="card">

      <section class="content">
        <h2>Interactive D3.js Chart</h2>
        <p>Each bubble represents one airline. Size = total passengers. Colour = most active region.</p>
        <div id="d3-chart"></div>
        <div class="tooltip"></div>

        <script>
        const width = Math.min(960, window.innerWidth - 40);
        const height = 600;

        const svg = d3.select("#d3-chart")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        const tooltip = d3.select(".tooltip");

        let simulation, node;

        d3.csv("d3_data.csv").then(data => {
          data.forEach(d => {
            d.Year = parseInt(d.Year);
            d["Total Passengers"] = parseInt(d["Total Passengers"]);
          });

          const years = Array.from(new Set(data.map(d => d.Year))).sort((a, b) => a - b);
          const regions = Array.from(new Set(data.map(d => d["Top Region"]))).sort();
          const color = d3.scaleOrdinal(d3.schemeSet2).domain(regions);

          const dropdown = d3.select("#d3-chart")
            .insert("div", ":first-child")
            .attr("class", "dropdown")
            .html(`
              <label for="year-select">Select Year: </label>
              <select id="year-select">
                ${years.map(year => `<option value="${year}">${year}</option>`).join("")}
              </select>
              <button id="play-btn">Play ▶</button>
            `);

          const legend = d3.select("#d3-chart")
            .append("div")
            .attr("class", "legend");

          legend.selectAll("span")
            .data(regions)
            .enter()
            .append("span")
            .html(d => `<svg width="12" height="12"><rect width="12" height="12" fill="${color(d)}" /></svg> ${d}`);

          let currentYearIndex = 0;
          let intervalId = null;

          function drawBubbles(selectedYear) {
            const yearData = data.filter(d => d.Year === selectedYear);
            const maxPassengers = d3.max(yearData, d => d["Total Passengers"]);

            const radiusScale = d3.scaleSqrt()
              .domain([0, maxPassengers])
              .range([5, 50]);

            svg.selectAll("*").remove();

            simulation = d3.forceSimulation(yearData)
              .force("center", d3.forceCenter(width / 2, height / 2))
              .force("charge", d3.forceManyBody().strength(3))
              .force("collision", d3.forceCollide(d => radiusScale(d["Total Passengers"]) + 1))
              .on("tick", ticked);

            node = svg.selectAll("circle")
              .data(yearData)
              .enter()
              .append("circle")
                .attr("r", d => radiusScale(d["Total Passengers"]))
                .attr("fill", d => color(d["Top Region"]))
                .attr("stroke", "#444")
                .attr("stroke-width", 0.5)
                .on("mouseover", function(event, d) {
                  tooltip
                    .style("opacity", 1)
                    .html(`<strong>${d["Operating Airline"]}</strong><br>Year: ${d.Year}<br>Region: ${d["Top Region"]}<br>Passengers: ${d["Total Passengers"].toLocaleString()}`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 40) + "px");
                })
                .on("mouseout", () => tooltip.style("opacity", 0))
                .on("click", function(event, d) {
                  node.attr("stroke", "#444").attr("stroke-width", 0.5);
                  d3.select(this).attr("stroke", "black").attr("stroke-width", 2);
                });

            function ticked() {
              node.attr("cx", d => d.x).attr("cy", d => d.y);
            }
          }

          drawBubbles(years[currentYearIndex]);

          d3.select("#year-select").on("change", function() {
            const selectedYear = +this.value;
            currentYearIndex = years.indexOf(selectedYear);
            drawBubbles(selectedYear);
          });

          d3.select("#play-btn").on("click", function() {
            if (intervalId) {
              clearInterval(intervalId);
              intervalId = null;
              this.textContent = "Play ▶";
            } else {
              intervalId = setInterval(() => {
                currentYearIndex = (currentYearIndex + 1) % years.length;
                d3.select("#year-select").property("value", years[currentYearIndex]);
                drawBubbles(years[currentYearIndex]);
              }, 1200);
              this.textContent = "Pause ❚❚";
            }
          });
        });
        </script>

        

      <section class="content">
  <h2>D3 Bubble Chart – Airline Market Share by Year</h2>
  <div id="d3-chart"></div>
  <p style="max-width: 800px; margin: 40px auto 20px auto; text-align: justify; font-size: 15px;">
    This interactive bubble chart illustrates the annual market share of airlines operating through San Francisco International Airport (SFO), using total passenger volume as a size metric. Spanning from 1999 to 2023, the chart highlights year-over-year changes in airline dominance and regional focus. Each bubble represents an airline, with its size scaled to passenger traffic and colour indicating the most frequently served region. Users can explore specific years via a dropdown menu or use the “Play” button to animate market shifts over time. Key trends include the consistent prominence of major carriers like United and Southwest, the disappearance of merged airlines such as US Airways, and the sharp contraction during the COVID-19 pandemic. This visualisation provides a clear, comparative view of competitive dynamics at SFO and complements the project’s broader temporal and spatial analyses.
  </p>
</section>

      <section class="content">
        <h2>Interactive Passenger Count vs COVID Timeline</h2>
        <iframe src="assets/plots/passenger_vs_covid.html" width="100%" height="600" style="border:none;"></iframe>
        <p class="viz-description">
          This interactive time-series chart visualises the relationship between air travel activity at SFO and the public health impact of COVID-19. Users can toggle between a full-range view (1999–2023) of normalised monthly passenger volume, and a focused view (2019–2023) that overlays passenger trends with COVID-19 hospitalisations and positive test counts. The chart highlights the sharp decline in passenger traffic in early 2020, followed by gradual recovery, and allows for visual comparison against pandemic severity metrics. This visualisation provides contextual insight into how the pandemic affected airport operations over time.
        </p>
      </section>

      <section class="content">
  <h2>Airline–Region Sankey Diagram by Terminal</h2>
  <iframe src="assets/plots/sankey_diagram.html" width="100%" height="800" style="border:none;"></iframe>
  <p class="viz-description">
    This interactive Sankey diagram shows passenger volume flows from operating airlines to geographical regions, filtered by terminal. Users can select terminals to observe how traffic is distributed among carriers and destinations. The chart highlights United’s dominance in Terminal 3, diverse international flows through the International Terminal, and more balanced distributions in Terminals 1 and 2.
  </p>
</section>

<section class="content">
  <h2>Interactive Airline–Region Comparison (Altair)</h2>
  <iframe src="assets/plots/altair_airline_region.html" width="100%" height="600" style="border:none;"></iframe>
  <p class="viz-description">
    This interactive Altair chart compares passenger volume by airline and region for the top 15 carriers - without a specified timeframe. Users can brush-select airlines on the left chart to dynamically filter and explore corresponding regional traffic on the right. This view helps identify which airlines serve broader geographical areas versus those with more concentrated regional presence.
  </p>
</section>

<section class="content">
  <h2>Top Airlines During the COVID Era (2020–2023)</h2>
  <iframe src="assets/plots/covid_airline_performance_by_year.html" width="100%" height="500" style="border:none;"></iframe>
  <p class="viz-description">
    This interactive chart displays the top 20 airlines by passenger volume at SFO during the COVID-19 period. A dropdown menu allows users to select a specific year (2020–2023), revealing shifts in airline activity across the pandemic timeline. Colour represents geographic region, and tooltips offer further detail on each datapoint.
  </p>
</section>




      <section class="content">
        <h2>Other Visualizations</h2>
        <p>Interactive charts were made using <strong>Jupyter Notebook</strong>, with the exception of the D3 interactive bubble chart, which was implemented using Javascript. Please refer to the .ipynb file to see the visualization code and process. </p>

      </section>
    </div>
  </main>

  <footer>
    <p>© 2025 Samuel Seelan, Brandon Liu, Alexander Wang — DS 4200 Project</p>
  </footer>

</body>
</html>
